<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê¸°ì–µì˜ ëŠª: ë¦¬ë¶€íŠ¸</title>
    <style>
        :root {
            --bg-color: #000;
            --chat-bg: #121212;
            --my-msg-bg: #2d5a27; /* ì¹´í†¡ ëŠë‚Œ ì‚´ì§ */
            --other-msg-bg: #222;
            --system-msg-bg: #1a1a1a;
            --accent: #d32f2f;
            --text-main: #e0e0e0;
            --font: 'Noto Sans KR', sans-serif; /* í•œê¸€ í°íŠ¸ ì ìš© */
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font);
            margin: 0;
            display: flex;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }

        #game-frame {
            width: 100%;
            max-width: 450px;
            background-color: var(--chat-bg);
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.1);
        }

        /* í—¤ë” */
        header {
            padding: 15px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(20, 20, 20, 0.95);
            z-index: 10;
        }
        .room-title { font-weight: bold; font-size: 1rem; }
        .red-dot { width: 8px; height: 8px; background: red; border-radius: 50%; display: inline-block; animation: blink 2s infinite; }

        /* ì±„íŒ… ì˜ì—­ */
        #chat-window {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            scroll-behavior: smooth;
            padding-bottom: 40px;
        }

        .msg {
            max-width: 85%;
            padding: 10px 15px;
            border-radius: 12px;
            font-size: 0.95rem;
            line-height: 1.6;
            word-break: break-all;
            position: relative;
            opacity: 0;
            animation: slideUp 0.4s forwards;
        }

        .msg-left { align-self: flex-start; background: var(--other-msg-bg); border-top-left-radius: 2px; }
        .msg-right { align-self: flex-end; background: var(--my-msg-bg); color: #fff; border-top-right-radius: 2px; }
        .msg-system { 
            align-self: center; 
            background: rgba(255,255,255,0.05); 
            color: #888; 
            font-size: 0.8rem; 
            text-align: center;
            padding: 5px 15px;
            border-radius: 20px;
            margin: 10px 0;
            width: fit-content;
        }

        .sender { font-size: 0.75rem; color: #888; margin-bottom: 4px; display: block; }
        
        /* ì¦ê±° ìë£Œ ìŠ¤íƒ€ì¼ */
        .evidence-box {
            background: #1a1a1a;
            border: 1px solid #444;
            padding: 15px;
            border-radius: 8px;
            margin-top: 5px;
        }
        .evidence-title { color: var(--accent); font-weight: bold; font-size: 0.9rem; margin-bottom: 5px; display: block;}
        .evidence-img { width: 100%; height: 120px; background: #000; display: flex; align-items: center; justify-content: center; color: #555; font-size: 0.8rem; margin-top: 10px; border: 1px dashed #333;}

        /* ì…ë ¥ ì˜ì—­ */
        #interaction-area {
            background: #111;
            border-top: 1px solid #333;
            padding: 15px;
            min-height: 80px;
        }

        /* ì„ íƒì§€ ë²„íŠ¼ */
        .choices-container { display: flex; flex-direction: column; gap: 8px; }
        .btn-choice {
            background: #2a2a2a;
            border: 1px solid #444;
            color: #ddd;
            padding: 14px;
            border-radius: 8px;
            text-align: left;
            cursor: pointer;
            transition: 0.2s;
            font-size: 0.95rem;
        }
        .btn-choice:hover { background: #333; border-color: #666; }

        /* í…ìŠ¤íŠ¸ ì…ë ¥ì°½ */
        .input-container { display: flex; gap: 10px; }
        #answer-input {
            flex: 1;
            background: #222;
            border: 1px solid #444;
            color: #fff;
            padding: 12px;
            border-radius: 6px;
            font-size: 1rem;
        }
        #submit-btn {
            background: var(--accent);
            color: #fff;
            border: none;
            padding: 0 20px;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
        }

        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        /* ê³µí¬ íš¨ê³¼ í´ë˜ìŠ¤ */
        .screen-shock { animation: shake 0.5s; }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 50% { transform: translateX(5px); } 75% { transform: translateX(-5px); } 100% { transform: translateX(0); } }

    </style>
</head>
<body>

<div id="game-frame">
    <header>
        <span class="room-title">ğŸ“ ì‚¬ê±´ë²ˆí˜¸ 24-1028 (ë¯¸ì œ)</span>
        <span class="red-dot"></span>
    </header>
    
    <div id="chat-window">
        </div>

    <div id="interaction-area">
        </div>
</div>

<script>
    /**
     * [ì‹œë‚˜ë¦¬ì˜¤ ë°ì´í„°]
     * type: 'chat' (ì¼ë°˜ëŒ€í™”), 'evidence' (ì¦ê±°ì œì‹œ), 'choice' (ì„ íƒì§€), 'input' (ì£¼ê´€ì‹)
     * answer: ì£¼ê´€ì‹ ì •ë‹µ (input íƒ€ì…ì¼ ë•Œ)
     * failScene: í‹€ë ¸ì„ ë•Œ ì´ë™í•  ê³³
     */
    const scenario = {
        "start": {
            type: "system",
            text: "ë³µêµ¬ëœ ëŒ€í™”ë°©ì— ì ‘ì†í–ˆìŠµë‹ˆë‹¤. (ë°ì´í„° ì†ì‹¤ë¥  12%)",
            next: "intro_1"
        },
        "intro_1": {
            speaker: "???",
            text: "ì•„ì§ë„ ì•ˆ ë‚˜ê°”ë„¤? ëˆì§ˆê¸°ë‹¤ ë„ˆí¬ë“¤.",
            next: "intro_2"
        },
        "intro_2": {
            speaker: "ë‚˜(Protagonist)",
            text: "ë„Œ ëˆ„êµ¬ì•¼? ë¯¼ìˆ˜ í•¸ë“œí° í•´í‚¹í•œ ê±°ì§€?",
            next: "intro_3"
        },
        "intro_3": {
            speaker: "???",
            text: "í•´í‚¹? ë‚´ê°€ ë‚´ í°ì„ ì“°ëŠ”ë° ì™œ í•´í‚¹ì´ì•¼.",
            next: "evidence_1"
        },
        "evidence_1": {
            type: "evidence",
            speaker: "ë¯¼ìˆ˜",
            title: "[ì‚¬ì§„ ì „ì†¡ë¨]",
            desc: "ë¹„ ì˜¤ëŠ” ë‚  ë‚šì‹œí„°, í™íƒ•ë¬¼ì— ë°˜ì¯¤ ì ê¸´ ìš´ë™í™” í•œ ì§.",
            text: "ì´ ì‹ ë°œ, ê·¸ë‚  ë„¤ê°€ ì‹ ê³  ì™”ë˜ ê±°ì–ì•„. ë‚˜ì´í‚¤ ì—ì–´í¬ìŠ¤.",
            next: "choice_1"
        },
        "choice_1": {
            type: "choice",
            text: "ë¯¼ìˆ˜ê°€ ë‚˜ë¥¼ íŠ¹ì •í•´ì„œ ì••ë°•í•´ì˜¤ê¸° ì‹œì‘í–ˆë‹¤.",
            options: [
                { label: "ë¬´ìŠ¨ ì†Œë¦¬ì•¼? ë‚œ ê·¸ë‚  ë‚šì‹œí„° ì•ˆ ê°”ì–´.", next: "deny_1" },
                { label: "ì‹ ë°œì€ í”í•œ ê±°ì–ì•„. ì–µì§€ ë¶€ë¦¬ì§€ ë§ˆ.", next: "deny_2" }
            ]
        },
        "deny_1": {
            speaker: "ë¯¼ìˆ˜",
            text: "ê±°ì§“ë§. Aë‘ BëŠ” ì´ë¯¸ ë‹¤ ë¶ˆì—ˆì–´. ë„¤ê°€ ë‚šì‹œí„°ë¡œ ë‚˜ ë¶€ë¥¸ ê±°ë¼ê³ .",
            next: "chapter_2"
        },
        "deny_2": {
            speaker: "ë¯¼ìˆ˜",
            text: "í”í•˜ë‹¤ê³ ? ì˜¤ë¥¸ìª½ ë’¤ê¿ˆì¹˜ì— ê»Œ ë¶™ì–´ìˆëŠ” ê²ƒë„ í”í•œê°€?",
            next: "chapter_2"
        },

        // ì±•í„° 2: ì•Œë¦¬ë°”ì´ ê¹¨ê¸° (ì£¼ê´€ì‹ í€´ì¦ˆ ë„ì…)
        "chapter_2": {
            type: "system",
            text: "[ê²½ê³ ] ì‹¬ë°•ìˆ˜ê°€ ì¦ê°€í•˜ê³  ìˆìŠµë‹ˆë‹¤.",
            next: "quiz_1_intro"
        },
        "quiz_1_intro": {
            speaker: "ë¯¼ìˆ˜",
            text: "ì¢‹ì•„, ê¸°íšŒë¥¼ ì¤„ê²Œ. ë„¤ ê¸°ì–µì´ ë§ëŠ”ì§€ í™•ì¸í•´ ë³´ì.\nê·¸ë‚  ìš°ë¦¬ê°€ ë§Œë‚¬ë˜ ë‚šì‹œí„° ë°©ê°ˆë¡œ í˜¸ìˆ˜, ê¸°ì–µí•´?",
            next: "quiz_1"
        },
        "quiz_1": {
            type: "input",
            speaker: "System",
            text: "ë°©ê°ˆë¡œ í˜¸ìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš”. (íŒíŠ¸: ì£½ì„ ì‚¬(4)ìê°€ ê²¹ì¹˜ëŠ” ë¶ˆê¸¸í•œ ìˆ«ì)",
            correctAnswer: "444",
            next: "quiz_1_correct",
            failNext: "quiz_1_fail"
        },
        "quiz_1_fail": {
            speaker: "ë¯¼ìˆ˜",
            text: "ë´, ê¸°ì–µ ëª» í•˜ì–ì•„. ë„¤ê°€ ê±°ê¸°ë¡œ ë¶ˆë €ìœ¼ë©´ì„œ ë²ˆí˜¸ë¥¼ ê¹Œë¨¹ì–´?",
            next: "game_over_1" // ì˜¤ë‹µ ì‹œ ë°°ë“œì—”ë”© ì§í–‰ ê°€ëŠ¥
        },
        "quiz_1_correct": {
            speaker: "ë¯¼ìˆ˜",
            text: "444í˜¸. ì •í™•íˆ ê¸°ì–µí•˜ë„¤. ê±°ê¸°ì„œ ë„¤ê°€ ë‚  ë°€ì—ˆì–ì•„.",
            next: "climax_1"
        },

        // í´ë¼ì´ë§¥ìŠ¤: ê¸°ì–µì˜ ì™œê³¡
        "climax_1": {
            speaker: "ë‚˜",
            text: "ì•„ë‹ˆì•¼! ë‚œ ë„ êµ¬í•˜ë ¤ê³  í–ˆì–´! ì†ì„ ë»—ì—ˆë‹¤ê³ !",
            next: "climax_2"
        },
        "climax_2": {
            speaker: "ë¯¼ìˆ˜",
            text: "ì†ì„ ë»—ì—ˆë‹¤ê³ ? ...ì´ ì˜ìƒì„ ë³´ê³ ë„ ê·¸ëŸ° ë§ì´ ë‚˜ì˜¬ê¹Œ?",
            next: "evidence_video"
        },
        "evidence_video": {
            type: "evidence",
            speaker: "System",
            title: "[ë™ì˜ìƒ ì¬ìƒ]",
            desc: "í”ë“¤ë¦¬ëŠ” í™”ë©´. ëˆ„êµ°ê°€ì˜ ì†ì´ ë¯¼ìˆ˜ì˜ ë“±ì„ ê°•í•˜ê²Œ ë– ë¯¸ëŠ” ì¥ë©´ì´ ì°í˜€ìˆë‹¤.",
            text: "ì˜ìƒ ì†ì˜ ì†ëª©ì—ëŠ” ë‚´ê°€ ì°¨ê³  ìˆëŠ” ì‹œê³„ê°€ ì„ ëª…í•˜ê²Œ ë³´ì¸ë‹¤.",
            next: "final_choice"
        },
        "final_choice": {
            type: "choice",
            text: "ì†ì´ ë–¨ë¦°ë‹¤. ë” ì´ìƒ ë¶€ì •í•  ìˆ˜ ì—†ë‹¤.",
            options: [
                { label: "...ë¯¸ì•ˆí•´. ë‚´ê°€ ê·¸ë¬ì–´.", next: "ending_true" },
                { label: "ì´ê±´ ì¡°ì‘ì´ì•¼!!! ìœ¼ì•„ì•„ì•…!!", next: "ending_madness" }
            ]
        },

        // ì—”ë”©
        "game_over_1": {
            type: "system",
            text: "ë‹¹ì‹ ì€ ê¸°ì–µì˜ ì••ë°•ì„ ì´ê¸°ì§€ ëª»í•˜ê³  ëŒ€í™”ë°©ì„ ë‚˜ê°”ìŠµë‹ˆë‹¤.\n[BAD ENDING: ë„ë§ì]",
            isEnding: true
        },
        "ending_true": {
            speaker: "ë¯¼ìˆ˜",
            text: "ì˜¤ë˜ ê±¸ë ¸ë„¤. ììˆ˜í•´. ê¸°ë‹¤ë¦´ê²Œ.",
            next: "ending_true_sys"
        },
        "ending_true_sys": {
            type: "system",
            text: "[TRUE ENDING: ì°¸íšŒ]\nê²½ì°°ì„œ ìœ„ì¹˜ê°€ ì „ì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.",
            isEnding: true
        },
        "ending_madness": {
            type: "system",
            text: "[HIDDEN ENDING: ë§ìƒ]\në‹¹ì‹ ì€ ì˜ì›íˆ 444í˜¸ì˜ ê¸°ì–µ ì†ì— ê°‡í˜”ìŠµë‹ˆë‹¤.",
            isEnding: true
        }
    };

    // [ê²Œì„ ì—”ì§„]
    const chatWindow = document.getElementById('chat-window');
    const interactionArea = document.getElementById('interaction-area');
    const gameFrame = document.getElementById('game-frame');

    function wait(ms) { return new Promise(r => setTimeout(r, ms)); }

    async function addMessage(scene) {
        const msgDiv = document.createElement('div');
        msgDiv.classList.add('msg');

        if (scene.type === 'system') {
            msgDiv.classList.add('msg-system');
            msgDiv.innerText = scene.text;
        } else if (scene.type === 'evidence') {
            msgDiv.classList.add('msg-left');
            msgDiv.innerHTML = `
                <span class="sender">${scene.speaker}</span>
                <div class="evidence-box">
                    <span class="evidence-title">${scene.title}</span>
                    <div style="font-size:0.9rem; color:#ccc;">${scene.text}</div>
                    <div class="evidence-img">${scene.desc}</div>
                </div>`;
        } else if (scene.speaker === 'ë‚˜') {
            msgDiv.classList.add('msg-right');
            msgDiv.innerText = scene.text;
        } else {
            msgDiv.classList.add('msg-left');
            msgDiv.innerHTML = `<span class="sender">${scene.speaker}</span>${scene.text}`;
        }

        chatWindow.appendChild(msgDiv);
        chatWindow.scrollTop = chatWindow.scrollHeight;
        await wait(600);
    }

    async function playScene(sceneId) {
        const scene = scenario[sceneId];
        if (!scene) return;

        // ë©”ì‹œì§€ ì¶œë ¥ (choice/input ë‹¨ê³„ì—ì„œë„ ì§ˆë¬¸ì€ ë§í’ì„ ìœ¼ë¡œ ë‚˜ì˜´)
        if (scene.text && !scene.options && scene.type !== 'choice') { 
            await addMessage(scene);
        }

        // ì—”ë”© ì²˜ë¦¬
        if (scene.isEnding) {
            interactionArea.innerHTML = "<div style='color:#666; text-align:center; padding:10px;'>ê²Œì„ ì¢…ë£Œ (ìƒˆë¡œê³ ì¹¨)</div>";
            return;
        }

        // ì…ë ¥ UI ìƒì„±
        interactionArea.innerHTML = ''; // ì´ˆê¸°í™”

        if (scene.type === 'choice') {
            // ì„¤ëª… í…ìŠ¤íŠ¸ ë¨¼ì € ì¶œë ¥
            if(scene.text) await addMessage({speaker: 'System', text: scene.text, type: 'system'});
            
            const btnContainer = document.createElement('div');
            btnContainer.className = 'choices-container';
            
            scene.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'btn-choice';
                btn.innerText = opt.label;
                btn.onclick = () => {
                    addMessage({speaker: 'ë‚˜', text: opt.label, type: 'chat'});
                    playScene(opt.next);
                };
                btnContainer.appendChild(btn);
            });
            interactionArea.appendChild(btnContainer);

        } else if (scene.type === 'input') {
            // ì§ˆë¬¸ í…ìŠ¤íŠ¸ ì¶œë ¥
            await addMessage(scene);

            const inputContainer = document.createElement('div');
            inputContainer.className = 'input-container';
            inputContainer.innerHTML = `
                <input type="text" id="answer-input" placeholder="ë‹µë³€ì„ ì…ë ¥í•˜ì„¸ìš”..." autocomplete="off">
                <button id="submit-btn">ì „ì†¡</button>
            `;
            interactionArea.appendChild(inputContainer);

            const input = inputContainer.querySelector('#answer-input');
            const btn = inputContainer.querySelector('#submit-btn');

            const checkAnswer = () => {
                const val = input.value.trim();
                if (!val) return;
                
                addMessage({speaker: 'ë‚˜', text: val, type: 'chat'}); // ë‚´ ë‹µë³€ ë§í’ì„  ì¶”ê°€
                
                if (val.includes(scene.correctAnswer)) { // ì •ë‹µ í¬í•¨ ì—¬ë¶€ í™•ì¸
                    playScene(scene.next);
                } else {
                    // ì˜¤ë‹µ ì—°ì¶œ
                    gameFrame.classList.add('screen-shock');
                    setTimeout(()=>gameFrame.classList.remove('screen-shock'), 500);
                    
                    // ì˜¤ë‹µ ì‹œ ë°”ë¡œ ê²Œì„ì˜¤ë²„ë¡œ ê°ˆì§€, ë‹¤ì‹œ ê¸°íšŒë¥¼ ì¤„ì§€ ì‹œë‚˜ë¦¬ì˜¤ì— ë”°ë¼ ë‹¤ë¦„
                    if(scene.failNext) playScene(scene.failNext);
                    else {
                         addMessage({speaker: 'System', text: "í‹€ë ¸ìŠµë‹ˆë‹¤. ë‹¤ì‹œ ìƒê°í•´ ë³´ì„¸ìš”.", type: 'system'});
                         input.value = '';
                    }
                }
            };

            btn.onclick = checkAnswer;
            input.onkeypress = (e) => { if(e.key === 'Enter') checkAnswer(); };

        } else if (scene.next) {
            // ì¼ë°˜ ëŒ€í™”ë©´ ìë™ìœ¼ë¡œ ë‹¤ìŒ ì¥ë©´
            setTimeout(() => playScene(scene.next), 800);
        }
    }

    // ê²Œì„ ì‹œì‘
    window.onload = () => {
        setTimeout(() => playScene('start'), 1000);
    };

</script>
</body>
</html>
