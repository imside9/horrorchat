<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>기억의 늪</title>
    <style>
        /* [스타일 시트: 공포 분위기 & 텍스트힙] */
        :root {
            --bg-color: #050505;
            --chat-bg: #111;
            --my-msg-bg: #3a3a3a;
            --other-msg-bg: #222;
            --accent: #ff3333;
            --text-main: #d0d0d0;
            --font: 'Courier New', monospace;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: var(--font);
            margin: 0;
            display: flex;
            justify-content: center;
            height: 100vh;
            overflow: hidden;
        }

        #game-frame {
            width: 100%;
            max-width: 450px;
            background-color: var(--chat-bg);
            display: flex;
            flex-direction: column;
            position: relative;
            box-shadow: 0 0 30px rgba(0,0,0,0.9);
        }

        /* 헤더 */
        header {
            padding: 15px;
            border-bottom: 1px solid #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: rgba(0,0,0,0.8);
            z-index: 10;
        }
        .room-name { font-weight: bold; font-size: 1.1rem; }
        .count { color: #666; font-size: 0.8rem; }

        /* 채팅 영역 */
        #chat-window {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 12px;
            scroll-behavior: smooth;
        }

        .msg {
            max-width: 80%;
            padding: 10px 14px;
            border-radius: 8px;
            font-size: 0.9rem;
            line-height: 1.5;
            opacity: 0;
            animation: fadeIn 0.5s forwards;
            word-break: break-all;
        }

        .msg-left { align-self: flex-start; background: var(--other-msg-bg); border-top-left-radius: 0; }
        .msg-right { align-self: flex-end; background: var(--my-msg-bg); color: #fff; border-top-right-radius: 0; }
        .msg-system { 
            align-self: center; 
            background: none; 
            color: #555; 
            font-size: 0.75rem; 
            border: 1px solid #222; 
            text-align: center;
            width: 90%;
        }

        .sender-name { font-size: 0.7rem; color: #777; margin-bottom: 4px; display: block; }
        
        /* 이미지 플레이스홀더 */
        .msg-image {
            background: #000;
            border: 1px dashed #444;
            color: #ff3333;
            text-align: center;
            padding: 30px 0;
            font-size: 0.8rem;
        }

        /* 선택지 영역 */
        #choice-area {
            padding: 15px;
            background: #0a0a0a;
            border-top: 1px solid #333;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .btn {
            background: transparent;
            border: 1px solid #444;
            color: #bbb;
            padding: 12px;
            cursor: pointer;
            font-family: var(--font);
            text-align: left;
            transition: 0.2s;
        }
        .btn:hover { background: #222; border-color: #888; color: #fff; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        
        /* 공포 효과 */
        .glitch-mode { animation: shake 0.2s infinite; }
        .red-theme { background-color: #200 !important; }
        
        @keyframes shake {
            0% { transform: translate(1px, 1px) rotate(0deg); }
            10% { transform: translate(-1px, -2px) rotate(-1deg); }
            20% { transform: translate(-3px, 0px) rotate(1deg); }
            30% { transform: translate(3px, 2px) rotate(0deg); }
            40% { transform: translate(1px, -1px) rotate(1deg); }
            50% { transform: translate(-1px, 2px) rotate(-1deg); }
            60% { transform: translate(-3px, 1px) rotate(0deg); }
            70% { transform: translate(3px, 1px) rotate(-1deg); }
            80% { transform: translate(-1px, -1px) rotate(1deg); }
            90% { transform: translate(1px, 2px) rotate(0deg); }
            100% { transform: translate(1px, -2px) rotate(-1deg); }
        }

    </style>
</head>
<body>

<div id="game-frame">
    <header>
        <span class="room-name">초대받지 않은 방</span>
        <span class="count" id="user-count">4명</span>
    </header>
    
    <div id="chat-window"></div>
    <div id="choice-area"></div>
</div>

<script>
    /**
     * [기획자님을 위한 시나리오 설정 영역]
     * karma: +는 진실/인정, -는 거짓/부인
     * next: 다음에 이어질 장면 ID
     */
    const scenario = {
        "start": {
            text: "오랜만이다. 다들 잘 지냈어?",
            speaker: "민수",
            choices: [
                { text: "민수야? 너 정말 민수야?", next: "scene_1_good", karma: 1 },
                { text: "누구세요? 민수는 죽었잖아.", next: "scene_1_bad", karma: -1 }
            ]
        },
        "scene_1_good": {
            text: "나 잊어버린 줄 알았는데... 감동이네.",
            speaker: "민수",
            next: "scene_2"
        },
        "scene_1_bad": {
            text: "죽어? 내가 왜 죽어? 난 여기 계속 있었는데.",
            speaker: "민수",
            next: "scene_2"
        },
        "scene_2": {
            text: "누가 장난치는 거야! 다 나가!",
            speaker: "익명 A",
            next: "scene_3"
        },
        "scene_3": {
            text: "나가는 문은 없어. 내가 너희들한테 줄 게 있거든.",
            speaker: "민수",
            next: "scene_4_photo"
        },
        "scene_4_photo": {
            type: "image",
            text: "[이미지 전송됨: 유리가 깨진 낡은 손목시계]",
            speaker: "민수",
            next: "scene_4_q"
        },
        "scene_4_q": {
            text: "이 시계 기억나는 사람?",
            speaker: "민수",
            choices: [
                { text: "(모르는 척) 이게 뭔데?", next: "scene_5_lie", karma: -2 },
                { text: "(움찔) ...이걸 네가 어떻게 가지고 있어?", next: "scene_5_truth", karma: 2 }
            ]
        },
        "scene_5_lie": {
            text: "모르는 척하지 마. 네가 선물해 줬던 거잖아.",
            speaker: "민수",
            next: "scene_6"
        },
        "scene_5_truth": {
            text: "그래, 역시 넌 기억하는구나. 내 마지막 시간.",
            speaker: "민수",
            next: "scene_6"
        },
        "scene_6": {
            text: "야, A가 말이 없어. 연결이 끊겼대...",
            speaker: "익명 B",
            next: "scene_7"
        },
        "scene_7": {
            text: "거짓말쟁이는 먼저 보냈어. 이제 너 차례야. 4시 44분, 낚시터.",
            speaker: "민수",
            choices: [
                { text: "난 낚시터 안 갔어! 기억 안 나!", next: "calc_ending", karma: -5 },
                { text: "...그때는 정말 사고였어. 미안해.", next: "calc_ending", karma: 5 }
            ]
        },
        
        // [엔딩 분기점 로직은 아래 JS에서 처리]
        "ending_bad": {
            text: "끝까지 거짓말이네. 넌 평생 여기서 나랑 놀자.",
            speaker: "민수(System)",
            type: "ending",
            effect: "horror"
        },
        "ending_normal": {
            text: "살인자. 살인자. 살인자. 살인자.",
            speaker: "99명",
            type: "ending",
            effect: "glitch"
        },
        "ending_true": {
            text: "그래, 그 말을 듣고 싶었어. 경찰서 위치 보낼게. 죗값 치르고 와.",
            speaker: "민수",
            type: "ending",
            effect: "clean"
        }
    };

    // [게임 상태 변수]
    let currentKarma = 0; // 업보 수치
    const chatWindow = document.getElementById('chat-window');
    const choiceArea = document.getElementById('choice-area');
    const headerCount = document.getElementById('user-count');

    // [기능 함수]
    function wait(ms) { return new Promise(r => setTimeout(r, ms)); }

    async function addMessage(text, speaker, type='chat') {
        const msgDiv = document.createElement('div');
        msgDiv.classList.add('msg');
        
        if (type === 'image') {
            msgDiv.classList.add('msg-image');
            msgDiv.innerText = text; // 실제 이미지 태그로 교체 가능
        } else if (speaker === '나') {
            msgDiv.classList.add('msg-right');
            msgDiv.innerText = text;
        } else if (speaker === 'System' || speaker.includes('System')) {
            msgDiv.classList.add('msg-system');
            msgDiv.innerHTML = text;
        } else {
            msgDiv.classList.add('msg-left');
            msgDiv.innerHTML = `<span class="sender-name">${speaker}</span>${text}`;
        }

        chatWindow.appendChild(msgDiv);
        chatWindow.scrollTop = chatWindow.scrollHeight;
        await wait(800); // 타이핑 연출 딜레이
    }

    async function playScene(sceneId) {
        // 엔딩 계산 로직
        if (sceneId === 'calc_ending') {
            await wait(1000);
            if (currentKarma >= 5) playScene('ending_true');
            else if (currentKarma <= -5) playScene('ending_bad');
            else playScene('ending_normal');
            return;
        }

        const scene = scenario[sceneId];
        if (!scene) return;

        // 메시지 출력
        await addMessage(scene.text, scene.speaker, scene.type);

        // 엔딩별 특수 효과
        if (scene.type === 'ending') {
            if(scene.effect === 'glitch') {
                document.getElementById('game-frame').classList.add('glitch-mode');
                headerCount.innerText = "99명";
                headerCount.style.color = "red";
            } else if (scene.effect === 'horror') {
                document.body.classList.add('red-theme');
                alert("당신의 스마트폰이 해킹당했습니다.");
            } else {
                alert("민수님이 퇴장하셨습니다.");
            }
            choiceArea.innerHTML = "<div style='color:#666; text-align:center;'>게임 종료 (새로고침하여 다시 시작)</div>";
            return;
        }

        // 다음 장면 자동 이동 또는 선택지 표시
        if (scene.choices) {
            choiceArea.innerHTML = '';
            scene.choices.forEach(choice => {
                const btn = document.createElement('button');
                btn.className = 'btn';
                btn.innerText = choice.text;
                btn.onclick = () => {
                    // 선택지 클릭 처리
                    choiceArea.innerHTML = '';
                    addMessage(choice.text, '나');
                    if(choice.karma) currentKarma += choice.karma; // 카르마 업데이트
                    playScene(choice.next);
                };
                choiceArea.appendChild(btn);
            });
        } else if (scene.next) {
            playScene(scene.next);
        }
    }

    // 게임 시작
    window.onload = () => {
        setTimeout(() => playScene('start'), 1000);
    };

</script>
</body>
</html>
